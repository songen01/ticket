(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7603:function(e,t,o){Promise.resolve().then(o.bind(o,8806)),Promise.resolve().then(o.t.bind(o,2391,23)),Promise.resolve().then(o.t.bind(o,9285,23))},8806:function(e,t,o){"use strict";o.r(t),o.d(t,{Header:function(){return N}});var r=o(3518),n=o(306),s=o(8305),i=o(2946),l=o(8781),a=o(7283),c=o(7960),d=o(5250),u=o(1491),g=o(17),h=o(265),x=o(3085),v=o(3033),f=o(9160),p=o(9197),m=o(6249),w=o(1321),j=o(5083),y=o(7520),S=o(3814),b=o.n(S),Z=o(4098),A=o(7851),_=o(7024),P=o(6381),k=o(8856);let N=()=>{var e;let[t,o]=p.useState(!1),S=(0,p.useRef)(!1),N=(0,w.GT)(e=>e.setAleoPrivateKey),K=(0,w.GT)(e=>e.setAleoAddress),I=(0,w.GT)(e=>e.Address),C=(0,w.GT)(e=>e.PK),[O,R]=(0,p.useState)(1),T=(0,p.useRef)();(0,p.useRef)();let[H,E]=p.useState(null),J=t?"simple-popover":void 0;(0,p.useEffect)(()=>{var e=indexedDB.open("aleoDB",1);e.onupgradeneeded=function(e){var t;let o=null===(t=e.target)||void 0===t?void 0:t.result;o.objectStoreNames.contains("AleoStore")||o.createObjectStore("AleoStore",{keyPath:"id"})},e.onsuccess=function(e){var t=e.target.result,o=t.transaction(["AleoStore"],"readonly");o.objectStore("AleoStore").getAll().onsuccess=function(e){var t=e.target.result;window.localStorage.setItem("aleoRecords",JSON.stringify(t))},o.oncomplete=function(e){t.close()}},async function(){var e,t;console.log(1),await m.default(),console.log(m),JSON.parse(null===(e=window)||void 0===e?void 0:e.localStorage.getItem("aleoRecords"))&&JSON.parse(null===(t=window)||void 0===t?void 0:t.localStorage.getItem("aleoRecords")).forEach((e,t)=>{var o;let r=(null==m?void 0:null===(o=m.PrivateKey)||void 0===o?void 0:o.from_string(C)).decryptrecords(JSON.stringify([{record_ciphertext:e.record_ciphertext,sn_id:e.sn_id}]));r&&j.Z.get("https://chain.daosso.xyz/testnet3/find/transitionID/"+JSON.parse(r)[0].sn_id).then(t=>{console.log(t,"is used");var o=indexedDB.open("aleoDB",1);o.onsuccess=function(t){var o=t.target.result,r=o.transaction(["AleoStore"],"readwrite"),n=r.objectStore("AleoStore").delete(e.id);n.onsuccess=function(e){console.log("success")},n.onerror=function(e){console.log("fail")},r.oncomplete=function(){o.close()}},o.onerror=function(e){console.log("open db error")}})})}()},[O]);let B=()=>{o(!1);let e=async e=>{var t;let o;if(S.current)return;T.current=(0,y.y)(),m||await (0,m.default)();let r=null==m?void 0:m.PrivateKey.from_string(C),n=null==r?void 0:r.to_view_key().to_string(),s=null==r?void 0:r.to_address().to_string();for(K(s),window.localStorage.setItem("aleoAddress",s),o=window.localStorage.getItem("aleoHeight")?parseInt(window.localStorage.getItem("aleoHeight")):0;;){S.current=!0;let e=await j.Z.get("https://chain.daosso.xyz/testnet3/latest/height").then(e=>e.data);console.log("current height: "+e);let r=await j.Z.get("https://aleo.daosso.xyz/records",{params:{start_block:o,end_block:o+1e3}});0===r.data.length&&(o>e?window.localStorage.setItem("aleoHeight",e.toString()):window.localStorage.setItem("aleoHeight",o.toString())),window.localStorage.setItem("aleoHeight",o.toString()),r.data.length>1&&(o=r.data[r.data.length-1].height);try{let e={viewKey:n,address:s,response:r.data,privateKey:C};null===(t=T.current)||void 0===t||t.postMessage(e)}catch(e){return}console.log(o),await new Promise(e=>setTimeout(e,3e3)),R(O+1)}};e()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"bg-gray-800 text-white p-4 fixed top-0 w-screen",children:(0,r.jsxs)("div",{className:"container mx-auto flex items-center justify-between",children:[(0,r.jsx)(b(),{href:"/",children:(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Swift Ticket"})}),(0,r.jsx)("nav",{children:(0,r.jsxs)("ul",{className:"flex space-x-4",children:[!I&&(0,r.jsx)("li",{children:(0,r.jsx)("span",{onClick:()=>{o(!0)},className:"hover:text-gray-300 cursor-pointer",children:" Connect"})}),(0,r.jsx)("li",{children:(0,r.jsx)(b(),{href:"/me",className:"hover:text-gray-300",children:"Me"})}),(0,r.jsx)("li",{children:I&&(0,r.jsx)("div",{"aria-describedby":J,variant:"contained",onClick:e=>{E(e.currentTarget)},children:"Profile"})})]})})]})}),(0,r.jsx)(n.ZP,{id:J,open:!!H,anchorEl:H,sx:{marginTop:4,maxHeight:700},onClose:()=>{E(null)},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,r.jsxs)(A.Z,{sx:{width:345},children:[(0,r.jsx)(_.Z,{sx:{height:340},image:"https://i.seadn.io/gcs/files/7386920d3a2250737e9278e8d44cba47.gif?auto=format&dpr=1&w=640",title:"green iguana"}),(0,r.jsxs)(P.Z,{children:[(0,r.jsx)(Z.Z,{gutterBottom:!0,variant:"h5",component:"div",children:"Aleo!"}),(0,r.jsxs)(Z.Z,{variant:"body2",color:"text.secondary",children:["Address: ",I?I.slice(0,12)+"..."+I.slice(-12):"-"]})]}),(0,r.jsxs)(s.Z,{sx:{width:"100%",maxWidth:360,bgcolor:"background.paper"},children:[(0,r.jsx)(i.Z,{variant:"inset",component:"li"}),null===(e=JSON.parse(window?.localStorage.getItem("aleoRecords")))||void 0===e?void 0:e.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(l.ZP,{children:[(0,r.jsx)(a.Z,{children:(0,r.jsx)(c.Z,{children:(0,r.jsx)(k.Z,{})})}),(0,r.jsx)(d.Z,{primary:"Record",secondary:e.result})]}),(0,r.jsx)(i.Z,{variant:"inset",component:"li"})]},1))]})]})}),(0,r.jsxs)(u.Z,{open:t,onClose:B,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,r.jsx)(g.Z,{id:"alert-dialog-title",children:"Set your Private Key"}),(0,r.jsx)(h.Z,{children:(0,r.jsx)(x.Z,{autoFocus:!0,margin:"dense",id:"Private",label:"Private Key",type:"Private",fullWidth:!0,variant:"standard",onChange:e=>N(e.currentTarget.value)})}),(0,r.jsxs)(v.Z,{children:[(0,r.jsx)(f.Z,{onClick:()=>{o(!1)},children:"Cancel"}),(0,r.jsx)(f.Z,{onClick:B,autoFocus:!0,children:"OK!"})]})]})]})}},7520:function(e,t,o){"use strict";o.d(t,{a:function(){return n},y:function(){return r}});let r=()=>new Worker(o.tu(new URL(o.p+o.u(34),o.b))),n=()=>new Worker(o.tu(new URL(o.p+o.u(701),o.b)))},1321:function(e,t,o){"use strict";o.d(t,{GT:function(){return n}});var r=o(5760);let n=(0,r.Ue)(e=>({PK:"",Address:"",ViewKey:"",login:!1,setAleoPrivateKey:t=>e(e=>({PK:t})),setAleoAddress:t=>e(e=>({Address:t})),setAleoViewKey:t=>e(e=>({ViewKey:t})),setLogin:t=>e(e=>({login:!0}))}));(0,r.Ue)(e=>({loading:!1,setLoading:t=>e(e=>({loading:t}))})),(0,r.Ue)(e=>({records:[],setRecords:t=>e(e=>({records:t}))}))},2391:function(){}},function(e){e.O(0,[317,429,160,213,857,157,801,313,447,744],function(){return e(e.s=7603)}),_N_E=e.O()}]);